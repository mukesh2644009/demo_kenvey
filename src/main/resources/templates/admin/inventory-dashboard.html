<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Dashboard - Kenway Industries</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/admin.css}" rel="stylesheet">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        .dashboard-card.full-width {
            grid-column: span 2;
        }
        .dashboard-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .dashboard-card h5 {
            margin-bottom: 1rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .category-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .category-stat-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            padding: 1.25rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .category-stat-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.25rem;
        }
        .category-stat-info h4 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--primary-dark);
        }
        .category-stat-info p {
            margin: 0;
            font-size: 0.85rem;
            color: #64748b;
        }
        .warranty-alert-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .warranty-alert-item:last-child {
            border-bottom: none;
        }
        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .dashboard-card.full-width {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Navbar -->
    <nav class="admin-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" th:href="@{/admin}">
                <img th:src="@{/images/kenway-logo.svg}" alt="Kenway" class="brand-logo">
                <span>Admin Panel</span>
            </a>
            <div class="nav-right">
                <a th:href="@{/admin}" class="btn btn-outline-light btn-sm me-2">
                    <i class="bi bi-house me-1"></i>Admin Home
                </a>
                <a th:href="@{/admin/logout}" class="btn btn-danger btn-sm">
                    <i class="bi bi-box-arrow-right me-1"></i>Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <h5><i class="bi bi-grid me-2"></i>Categories</h5>
            </div>
            <ul class="category-list">
                <li th:each="cat : ${categories}">
                    <a th:href="@{/admin/category/{id}(id=${cat.id})}" class="category-link">
                        <i th:class="${cat.icon} ?: 'bi bi-box'"></i>
                        <span th:text="${cat.name}">Category</span>
                        <span class="badge" th:text="${stats.categoryWiseCounts[cat.name]} ?: 0">0</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="page-header">
                <h1><i class="bi bi-graph-up me-2"></i>Inventory Dashboard</h1>
                <p>Overview of all inventory items and warranty status</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon bg-primary">
                        <i class="bi bi-box-seam"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${stats.totalItems}">0</h3>
                        <p>Total Items</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-info">
                        <i class="bi bi-check2-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${stats.activeItems}">0</h3>
                        <p>Active Items</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${stats.expiringWarrantiesCount}">0</h3>
                        <p>Expiring Soon</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-secondary">
                        <i class="bi bi-grid"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${stats.totalCategories}">0</h3>
                        <p>Categories</p>
                    </div>
                </div>
            </div>
            
            <!-- Warranty Stats Row -->
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-shield-check me-2"></i>Product Warranty
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-4">
                                    <h4 class="text-success mb-0" th:text="${stats.activeProductWarranties}">0</h4>
                                    <small class="text-muted">Active</small>
                                </div>
                                <div class="col-4">
                                    <h4 class="text-warning mb-0" th:text="${stats.expiringProductWarrantiesCount}">0</h4>
                                    <small class="text-muted">Expiring</small>
                                </div>
                                <div class="col-4">
                                    <h4 class="text-danger mb-0" th:text="${stats.expiredProductWarrantiesCount}">0</h4>
                                    <small class="text-muted">Expired</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-gear me-2"></i>Motor Warranty
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-4">
                                    <h4 class="text-success mb-0" th:text="${stats.activeMotorWarranties}">0</h4>
                                    <small class="text-muted">Active</small>
                                </div>
                                <div class="col-4">
                                    <h4 class="text-warning mb-0" th:text="${stats.expiringMotorWarrantiesCount}">0</h4>
                                    <small class="text-muted">Expiring</small>
                                </div>
                                <div class="col-4">
                                    <h4 class="text-danger mb-0" th:text="${stats.expiredMotorWarrantiesCount}">0</h4>
                                    <small class="text-muted">Expired</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Category-wise Stats -->
                <div class="dashboard-card full-width">
                    <h5><i class="bi bi-pie-chart"></i>Category-wise Distribution</h5>
                    <div class="category-stats">
                        <div class="category-stat-card" th:each="cat : ${stats.categories}">
                            <div class="category-stat-icon">
                                <i th:class="${cat.icon} ?: 'bi bi-box'"></i>
                            </div>
                            <div class="category-stat-info">
                                <h4 th:text="${stats.categoryWiseCounts[cat.name]} ?: 0">0</h4>
                                <p th:text="${cat.name}">Category</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Expiring Warranties -->
                <div class="dashboard-card">
                    <h5><i class="bi bi-clock text-warning"></i>Warranties Expiring Soon (30 days)</h5>
                    
                    <!-- Product Warranty Alerts -->
                    <div th:if="${stats.expiringProductWarranties != null and !stats.expiringProductWarranties.isEmpty()}" class="mb-3">
                        <h6 class="text-primary"><i class="bi bi-shield-check me-1"></i>Product Warranty</h6>
                        <div class="warranty-alert-item" th:each="item : ${stats.expiringProductWarranties}">
                            <div>
                                <a th:href="@{/admin/items/{id}(id=${item.id})}">
                                    <strong th:text="${item.name}">Item Name</strong>
                                </a>
                                <br><small class="text-muted" th:text="${item.customerName}">Customer</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-warning text-dark" th:text="${item.productWarrantyDaysRemaining()} + ' days'">0 days</span>
                                <br><small th:text="${#temporals.format(item.productWarrantyEndDate, 'dd MMM yyyy')}">Date</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Motor Warranty Alerts -->
                    <div th:if="${stats.expiringMotorWarranties != null and !stats.expiringMotorWarranties.isEmpty()}">
                        <h6 class="text-success"><i class="bi bi-gear me-1"></i>Motor Warranty</h6>
                        <div class="warranty-alert-item" th:each="item : ${stats.expiringMotorWarranties}">
                            <div>
                                <a th:href="@{/admin/items/{id}(id=${item.id})}">
                                    <strong th:text="${item.name}">Item Name</strong>
                                </a>
                                <br><small class="text-muted" th:text="${item.customerName}">Customer</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-warning text-dark" th:text="${item.motorWarrantyDaysRemaining()} + ' days'">0 days</span>
                                <br><small th:text="${#temporals.format(item.motorWarrantyEndDate, 'dd MMM yyyy')}">Date</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center text-muted py-3" 
                         th:if="${(stats.expiringProductWarranties == null or stats.expiringProductWarranties.isEmpty()) and (stats.expiringMotorWarranties == null or stats.expiringMotorWarranties.isEmpty())}">
                        <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
                        <p class="mb-0 mt-2">No warranties expiring in next 30 days</p>
                    </div>
                </div>

                <!-- Recent Items -->
                <div class="dashboard-card">
                    <h5><i class="bi bi-clock-history"></i>Recently Added Items</h5>
                    <div th:if="${stats.recentItems != null and !stats.recentItems.isEmpty()}">
                        <div class="warranty-alert-item" th:each="item : ${stats.recentItems}" th:if="${itemStat.index < 5}">
                            <div>
                                <a th:href="@{/admin/items/{id}(id=${item.id})}">
                                    <strong th:text="${item.name}">Item Name</strong>
                                </a>
                                <br><small class="text-muted" th:text="${item.category.name}">Category</small>
                            </div>
                            <div class="text-end">
                                <code th:text="${item.itemId}">ID</code>
                                <br><small th:text="${#temporals.format(item.createdAt, 'dd MMM')}">Date</small>
                            </div>
                        </div>
                    </div>
                    <div class="text-center text-muted py-3" th:if="${stats.recentItems == null or stats.recentItems.isEmpty()}">
                        <i class="bi bi-inbox"></i>
                        <p class="mb-0 mt-2">No items added yet</p>
                    </div>
                    <div class="text-center mt-3" th:if="${stats.recentItems != null and !stats.recentItems.isEmpty()}">
                        <a th:href="@{/admin/items}" class="btn btn-sm btn-outline-primary">View All Items</a>
                    </div>
                </div>

                <!-- All Items Table -->
                <div class="dashboard-card full-width">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0"><i class="bi bi-table"></i>All Inventory Items</h5>
                        <a th:href="@{/admin/items/add}" class="btn btn-sm btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>Add Item
                        </a>
                    </div>
                    <div class="table-responsive" th:if="${stats.recentItems != null and !stats.recentItems.isEmpty()}">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Item ID</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Customer</th>
                                    <th>Purchase Date</th>
                                    <th>Warranty Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${stats.recentItems}">
                                    <td><code th:text="${item.itemId}">CLR-0001</code></td>
                                    <td th:text="${item.name}">Item Name</td>
                                    <td>
                                        <span class="badge bg-secondary" th:text="${item.category.name}">Category</span>
                                    </td>
                                    <td>
                                        <span th:text="${item.customerName} ?: '-'">Customer</span>
                                        <br th:if="${item.customerPhone}">
                                        <small class="text-muted" th:text="${item.customerPhone}">Phone</small>
                                    </td>
                                    <td th:text="${#temporals.format(item.dateOfPurchase, 'dd MMM yyyy')}">01 Jan 2024</td>
                                    <td>
                                        <!-- Product Warranty -->
                                        <div th:if="${item.hasProductWarranty}" class="mb-1">
                                            <small class="d-block">
                                                <i class="bi bi-shield-check text-primary"></i> Product:
                                                <span th:if="${item.isProductWarrantyValid()}" class="text-success fw-bold" 
                                                      th:text="${item.productWarrantyDaysRemaining()} + 'd'">0d</span>
                                                <span th:unless="${item.isProductWarrantyValid()}" class="text-danger">Expired</span>
                                            </small>
                                        </div>
                                        <!-- Motor Warranty -->
                                        <div th:if="${item.hasMotorWarranty}">
                                            <small class="d-block">
                                                <i class="bi bi-gear text-success"></i> Motor:
                                                <span th:if="${item.isMotorWarrantyValid()}" class="text-success fw-bold" 
                                                      th:text="${item.motorWarrantyDaysRemaining()} + 'd'">0d</span>
                                                <span th:unless="${item.isMotorWarrantyValid()}" class="text-danger">Expired</span>
                                            </small>
                                        </div>
                                        <span class="text-muted" th:unless="${item.hasAnyWarranty()}">No Warranty</span>
                                    </td>
                                    <td>
                                        <a th:href="@{/admin/items/{id}(id=${item.id})}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center py-4" th:if="${stats.recentItems == null or stats.recentItems.isEmpty()}">
                        <i class="bi bi-inbox" style="font-size: 3rem; color: #cbd5e1;"></i>
                        <h5 class="mt-3">No items in inventory</h5>
                        <p class="text-muted">Start by adding your first item</p>
                        <a th:href="@{/admin/items/add}" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>Add New Item
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

